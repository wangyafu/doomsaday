# 多模型配置说明

## 概述

后端现在支持为不同的 AI 角色配置不同的模型，实现更灵活的成本控制和性能优化。

## 支持的角色

- **Narrator（叙事者）**: 负责生成每日剧情和事件描述
- **Judge（裁判）**: 负责判定玩家行动结果
- **Ending（结局评论员）**: 负责生成结局评价和人设词

## 配置方式

### 1. 通用配置（必填）

这是所有角色的默认配置，当某个角色没有专用配置时会使用这些值：

```env
OPENAI_API_KEY=your_api_key_here
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o-mini
```

### 2. 角色专用配置（可选）

为特定角色配置独立的 API 密钥、端点和模型：

```env
# Narrator 专用配置
NARRATOR_API_KEY=your_narrator_api_key
NARRATOR_BASE_URL=https://api.openai.com/v1
NARRATOR_MODEL=gpt-4o

# Judge 专用配置
JUDGE_API_KEY=your_judge_api_key
JUDGE_BASE_URL=https://api.openai.com/v1
JUDGE_MODEL=gpt-4o-mini

# Ending 专用配置
ENDING_API_KEY=your_ending_api_key
ENDING_BASE_URL=https://api.openai.com/v1
ENDING_MODEL=gpt-4o
```

## 配置优先级

对于每个角色，配置的优先级为：

1. 角色专用配置（如果设置）
2. 通用配置（作为默认值）

例如，如果只设置了 `NARRATOR_MODEL=gpt-4o`，而没有设置 `NARRATOR_API_KEY` 和 `NARRATOR_BASE_URL`，那么：
- Narrator 会使用 `gpt-4o` 模型
- 但会使用通用的 `OPENAI_API_KEY` 和 `OPENAI_BASE_URL`

## 使用场景

### 场景 1：全部使用同一模型

只配置通用配置即可：

```env
OPENAI_API_KEY=sk-xxx
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o-mini
```

### 场景 2：叙事使用高级模型，其他使用经济模型

```env
# 通用配置（Judge 和 Ending 使用）
OPENAI_API_KEY=sk-xxx
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o-mini

# Narrator 使用更强大的模型
NARRATOR_MODEL=gpt-4o
```

### 场景 3：使用不同的 API 提供商

```env
# 通用配置（使用 OpenAI）
OPENAI_API_KEY=sk-xxx
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o-mini

# Narrator 使用其他提供商（如 Azure OpenAI）
NARRATOR_API_KEY=azure-key-xxx
NARRATOR_BASE_URL=https://your-resource.openai.azure.com/
NARRATOR_MODEL=gpt-4
```

### 场景 4：完全独立配置

```env
# 通用配置
OPENAI_API_KEY=sk-xxx
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o-mini

# 每个角色使用不同的配置
NARRATOR_API_KEY=sk-narrator-xxx
NARRATOR_BASE_URL=https://api.openai.com/v1
NARRATOR_MODEL=gpt-4o

JUDGE_API_KEY=sk-judge-xxx
JUDGE_BASE_URL=https://api.openai.com/v1
JUDGE_MODEL=gpt-4o-mini

ENDING_API_KEY=sk-ending-xxx
ENDING_BASE_URL=https://api.openai.com/v1
ENDING_MODEL=gpt-4o
```

## 成本优化建议

根据各角色的特点，推荐以下配置策略：

1. **Narrator（叙事者）**
   - 输出内容最多，对创意和文笔要求高
   - 建议使用较强的模型（如 `gpt-4o`）

2. **Judge（裁判）**
   - 输出内容中等，需要逻辑判断能力
   - 可使用中等模型（如 `gpt-4o-mini`）

3. **Ending（结局评论员）**
   - 调用频率最低（每局游戏仅一次）
   - 可使用较强模型提升体验（如 `gpt-4o`）

## 注意事项

1. 至少需要配置通用配置（`OPENAI_API_KEY`、`OPENAI_BASE_URL`、`OPENAI_MODEL`）
2. 角色专用配置可以部分设置，未设置的部分会自动使用通用配置
3. 修改 `.env` 文件后需要重启后端服务才能生效
4. 确保使用的模型支持 JSON 模式输出（Judge 和 Ending 需要）
